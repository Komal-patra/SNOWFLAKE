----> Creating the source table
CREATE OR REPLACE TABLE SOURCE_CUST_TABLE (
CUSTOMER_ID INT,
NAME STRING,
ADDRESS STRING,
PHONE STRING,
EMAIL STRING,
ACCOUNT_STATUS STRING
);

----> Creating the source table
CREATE OR REPLACE TABLE TARGET_DIM_CUST_TABLE (
CUSTOMER_ID INT,
NAME STRING,
ADDRESS STRING,
PHONE STRING,
EMAIL STRING,
ACCOUNT_STATUS STRING
);

INSERT INTO SOURCE_CUST_TABLE VALUES(1, 'KOMAL', 'IRELAND', '7777-7777', 'KOMAL@EMAIL.COM','ACTIVE'),
(2, 'NIKHIL', 'IRELAND', '79897-7777', 'NIKHIL@EMAIL.COM','ACTIVE'),
(3, 'RIDHI', 'IRELAND', '7097-7777', 'RIDHI@EMAIL.COM','ACTIVE');

SELECT * FROM SOURCE_CUST_TABLE;

INSERT INTO TARGET_DIM_CUST_TABLE VALUES(1, 'KOMAL', 'IRELAND', '7777-7777', 'KOMAL@EMAIL.COM','ACTIVE'),
(2, 'NIKHIL', 'DUBLIN,IRELAND', '79897-7777', 'NIKHIL@EMAIL.COM','ACTIVE'),
(3, 'RIDHI', 'IRELAND', '7097-7777', 'RIDHI@EMAIL.COM','INACTIVE');

SELECT * FROM TARGET_DIM_CUST_TABLE;

MERGE INTO TARGET_DIM_CUST_TABLE AS TARGET
USING SOURCE_CUST_TABLE AS SOURCE
ON TARGET.CUSTOMER_ID=SOURCE.CUSTOMER_ID
WHEN MATCHED AND (TARGET.NAME<>SOURCE.NAME OR TARGET.ADDRESS<>SOURCE.ADDRESS OR TARGET.PHONE<>SOURCE.PHONE OR TARGET.EMAIL<>SOURCE.EMAIL OR TARGET.ACCOUNT_STATUS<>SOURCE.ACCOUNT_STATUS) THEN
UPDATE SET TARGET.NAME=SOURCE.NAME, TARGET.ADDRESS=SOURCE.ADDRESS, TARGET.PHONE=SOURCE.PHONE, TARGET.EMAIL=SOURCE.EMAIL, TARGET.ACCOUNT_STATUS=SOURCE.ACCOUNT_STATUS

WHEN NOT MATCHED THEN
INSERT (CUSTOMER_ID, NAME, ADDRESS, PHONE, EMAIL, ACCOUNT_STATUS) VALUES (SOURCE.CUSTOMER_ID, SOURCE.NAME, SOURCE.ADDRESS, SOURCE.PHONE, SOURCE.EMAIL, SOURCE.ACCOUNT_STATUS);

SELECT * FROM SOURCE_CUST_TABLE;

SELECT * FROM TARGET_DIM_CUST_TABLE;

UPDATE SOURCE_CUST_TABLE 
SET ACCOUNT_STATUS='INACTIVE'
WHERE CUSTOMER_ID=3;

INSERT INTO SOURCE_CUST_TABLE VALUES(4, 'MUMMY', 'INDIA', '7777-8877', 'MUMMY@EMAIL.COM','ACTIVE');

DELETE FROM TARGET_DIM_CUST_TABLE WHERE CUSTOMER_ID=4;


--- Conclusion: In SCD type 1,if we try to update , the value can be overridden as well as new data can be inserted. Drawback is we cannot view history data.
